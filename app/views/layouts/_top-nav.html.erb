<nav class="top-nav navbar navbar-expand-md navbar-light <%= local_assigns[:css] %>" role="navigation">

  <%= link_to root_path, class: "navbar-brand", data: {turbolinks: false} do %>
    <%= image_tag('logo-sm.png', class: 'img-fluid m-0 p-0', alt: "FoodTalk.org: Helping Georgians Eat Healthy & Get Moving") %>
    <% if (avatar = DomainGroups::get_domain_group_icon(request.host)) %>
      <%= image_tag avatar, class: 'img-fluid m-0 p-0', alt: 'Partner logo' %>
    <% end %>
  <% end %>

  <button class="navbar-toggler justify-content-end" type="button" data-toggle="collapse" data-target="#navbarToggler1" aria-controls="navbarToggler1" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <% #cache [create_cache_key_prefix, "top-nav"], :expires_in => 1.month do %>
  <div class="collapse navbar-collapse" id="navbarToggler1">
    <ul class="navbar-nav mr-auto">

      <%
        my_css = (!@current_user.is_eligible?) ? "d-none" : "d-block"
      %>

      <li class="nav-item">
        <%= link_to(t("navigation.learn_online"),learn_online_path, id: "learn-online-link", class: "nav-link " + my_css  ) %>
      </li>

      <li class="nav-item">
        <%= link_to(t("navigation.blog"), blogs_index_path, class: "nav-link") %>
      </li>

      <li class="nav-item">
        <%= link_to(t("navigation.recipes"), recipes_path, class: "nav-link") %>
      </li>

      <li class="nav-item">
        <%= link_to(t("navigation.videos"), { controller: "videos", action: "index" }, class: "nav-link") %>
      </li>

      <li class="nav-item">
        <%= link_to(t("navigation.food_glossary"), { controller: "glossary_terms", action: "index" }, class: "nav-link") %>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false"><%=t("navigation.snap_ed_resources") %></a>
        <% #TODO: remove hardcoding color %>
        <div class="dropdown-menu" style="background-color: #de4527">
          <%= link_to(t("navigation.attend_a_class"), attend_class_index_path, class: "nav-link drop-down-item") %>
          <%= link_to(t("navigation.gis_resources"), maps_index_path, class: "nav-link drop-down-item") %>
        </div>
      </li>

      <% if(Rails.application.secrets.i18n_enabled) %>
      <li class="nav-item">
        <%= link_to(t("language_select_label"), "/#{t('language_select_value').to_sym}#{request.original_fullpath.slice(3..-1)}", class: "nav-link") %>
      </li>
      <% end %>

    </ul>

    <ul class="navbar-nav">
      <% if user_signed_in? %>
          <li class="nav-item <%= 'active' if params[:controller] == 'dashboard' %>">
            <%= link_to( fa_icon('user') + " #{t("navigation.my_dashboard")}" , { controller: "dashboard", action: "show" }, class: "nav-link", data: {turbolinks: false}) %>
          </li>
          <li class="nav-item" data-turbolinks="false">
            <%= link_to(t("navigation.logout"), logout_path, class: "nav-link mr-auto") %>
          </li>
      <% else %>
          <li class="nav-item" data-turbolinks="false">
            <%= link_to(t("navigation.login"), login_path, class: "nav-link mr-auto") %>
          </li>
      <% end %>

      <%
      site_search_enabled = false;
      if site_search_enabled
      %>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <%= fa_icon 'search' %>
        </a>
        <div class="dropdown-menu search-box" aria-labelledby="navbarDropdownMenuLink">

          <form class="form-inline">

            <label class="sr-only" for="searchInput">Name</label>
            <input type="text" class="form-control mb-2 mr-sm-2 mb-sm-0" id="searchInput" placeholder="Search...">
            <button type="submit" class="btn btn-primary">Submit</button>

          </form>
        </div>
      </li>

      <% end %>

    </ul>

  </div>
  <% #end %>
</nav>

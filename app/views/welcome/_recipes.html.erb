<div id="recipes" class="content-section row">

  <div class="col">

    <div class="d-flex justify-content-center mx-auto">
      <div class="media content-section-header align-items-center">

        <%= image_tag 'recipe-graphic.png', class: 'd-flex d-sm-none d-md-block mt-2 mr-3', alt: 'Recipe Card Icon', style: 'width: auto; height: 6rem;' %>
        <div class="media-body ml-3">
          <span class="content-section-title">Featured Recipes</span>
          <p class="content-section-copy-light">Our FoodTalk recipes contain delicious, healthy, and inexpensive meals!</p>
        </div>
      </div>
    </div>

    <div id="recipesCarousel" class="carousel slide" data-ride="carousel"  data-interval="false">

      <div class="carousel-inner" role="listbox">
        <%
          #TODO: FIX ME!  We want Featured Recipes Here
          #TODO: AJAXIFY ME!
          #TODO: put me in a helper
          per_page = 3
          total_pgs = Recipe.page(1).per(per_page).total_pages
          total_pgs_to_show = 2
          i = 1
          while i <= total_pgs_to_show && i <= total_pgs
            recipes = Recipe.page(i).per(per_page)
        %>
            <div class="carousel-item <%= 'active' if i == 1%>">
              <div class="d-flex justify-content-center">
                <div class="card-deck recipes-deck" >

                  <% recipes.each do |recipe| %>

                      <div class="card">

                        <div class="card-header">
                          <h4 class="card-title text-center mt-0"><%= recipe.title %> <small class="text-muted"><a href="#"><% fa_icon "star" %></a> <a href="#"><% fa_icon "share-alt" %></a></small></h4>
                        </div>

                        <%= link_to image_tag(recipe.image, class: 'card-img-top', alt: recipe.title), recipe_path(recipe), {"data-vbtype"=>'iframe', "data-autoplay"=>'true', "class"=>'venobox'} %>
                        <div class="card-body">

                          <div class="card-text text-justify mb-2"><%= recipe.description %></div>

                          <% if !recipe.categories.empty? %>
                              <div class="small text-left font-weight-bold">Categories</div>
                              <div class="small card-text text-left">
                                <% recipe.categories.each do |c| %>
                                    <%= link_to c.name, recipes_path(category_id: c.id), class: 'badge badge-light', role: 'button' %>
                                <% end %>
                              </div>
                          <% end %>

                          <% if !recipe.glossary_terms.empty? %>
                              <div class="small text-left font-weight-bold">Glossary Terms</div>
                              <div class="small card-text text-left">
                                <% recipe.glossary_terms.each do |gt| %>
                                    <a tabindex="0" class="badge badge-light" style="cursor:pointer;" role="button" data-toggle="popover" data-placement="top" data-trigger="focus" title="<%= gt.name %>" data-content="<%= gt.description %>">
                                      <%= gt.name %>
                                    </a>
                                <% end %>
                              </div>
                          <% end %>
                        </div>

                        <div class="card-footer text-center">
                          <%= link_to("Details", recipe_path(recipe), data: { vbtype: "iframe", autoplay: true }, class: "venobox btn btn-primary") %>
                        </div>
                      </div>

                  <% end %>



                </div>
              </div>
            </div>
        <%
          i += 1
          end
        %>

        <a class="carousel-control-prev" href="#recipesCarousel" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>

        <a class="carousel-control-next" href="#recipesCarousel" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>

    </div>

    <p class="justify-content-center mx-auto content-section-copy-light recipe-copy text-center pt-2"><%= link_to "Click Here", recipes_path %> to browse our entire catalog.</p>

    <% render partial: "welcome/scroll-down-for-more" %>

  </div>

</div>

<script language="JavaScript">

    var nextURL = '<%= eval(page_path + "(playlist_id: @playlist_id, page_token: @nextPageToken)") %>'; //seed page 2 from org request

    function updateNextURL(doc) {
        nextURL = $(doc).find("var#page-token").attr("href");
    }

    function getNextURL() {
        if(typeof nextURL !== 'undefined') {
            return nextURL;
        } else {
            console.log("UNDEFINED!")
        }
    }

    var $grid = $('.grid').masonry({
        // Masonry options...
        itemSelector: '.grid-item',
        fitWidth: true
    });

    var msnry = $grid.data('masonry');

    $grid.infiniteScroll({
        path: function() {
            return nextURL;
        },
        append: false,
        outlayer: msnry,
        responseType: 'text',
        history: false,

    });


    $grid.on( 'load.infiniteScroll', function( event, response ) {
        updateNextURL( response );
        var jqData = $(response)
        jqData.imagesLoaded( function() {
            $('.grid').append(jqData);
            $('.grid').masonry( 'appended', jqData );
        });
    });
</script>